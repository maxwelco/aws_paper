---
title: "tabela_uy"
author: "Maxwel Coura Oliveira"
date: "2/14/2022"
output: html_document
---



```{r}
library(tidyverse)
library(ggthemes)
library(ggtext)
library(reactablefmtr)
```


```{r}
read_csv("tabela_uy.csv") |> 
  janitor::clean_names() |> 
  mutate(ing_ativo = str_to_lower(ing_ativo)) |> 
  mutate(volumenes_cif_en_us = volumenes_cif_en_us * 100) -> uy_table
```

```{r}
uy_table |> 
  mutate(volumenes_cif_en_us = round(volumenes_cif_en_us, 0)) |> 
  pivot_wider(names_from = year, values_from = volumenes_cif_en_us) |> 
  dplyr::select(-moa_group) -> uy_table1
```


```{r}
uy_table1 |> 
  reactable(
    compact = TRUE,
    pagination = FALSE,
    showSortIcon = FALSE,
    defaultSorted = "1995",
    defaultSortOrder = 'desc',
      defaultColDef = colDef(
    align = 'center', 
    style = color_scales(uy_table1, 
                         brighten_text = FALSE, 
                         text_color = 'grey', 
                         bold_text = TRUE, span = TRUE)
))  -> tabuy

save_reactable(tabuy, "table1.png")
```



```{r}
library(tidyverse)
library(ggthemes)
library(lubridate)
library(waffle)
library(ggtext)
```

```{r}
read_csv("tabela_uy.csv") |> 
  janitor::clean_names() -> uy_table
```


```{r}
uy_table |> 
  mutate(values = as.integer(round(values, 0))) |> 
  group_by(year) |> 
  summarise(values = sum(values))
```





```{r}
uy_table |> 
  group_by(year) |> 
#  mutate(volumenes_cif_en_us = round(volumenes_cif_en_us, 0)) |> 
  summarise(values = sum(values))
```


```{r}
mycolors <- c(RColorBrewer::brewer.pal(name="Set1", n = 8),
              RColorBrewer::brewer.pal(name="Paired", n = 6))

uy_table |> 
  mutate(values = as.integer(round(values, 0))) |> 
  mutate(year = as_factor(year)) |> 
  mutate_if(is.character, as_factor) |> 
  group_by(year, moa_group) |> 
  summarise(values = sum(values)) |> 
  ggplot(aes(fill = moa_group, values = values)) +
  geom_waffle(color = "white", size = .25, n_rows = 10, flip = TRUE) +
  facet_wrap(~year, nrow = 1, strip.position = "bottom") +
  scale_x_discrete() + 
  labs(fill = "SOA group",
       y = "% of CIF in US$") +
  scale_y_continuous(
    labels = function(x) x * 10, # make this multiplyer the same as n_rows
                     expand = c(0,0)) +
  scale_fill_manual(values = mycolors) +
  theme_bw() +
  theme(legend.position = "right",
        legend.background = element_rect(colour = NA, fill = NA),
        legend.key = element_rect(colour = NA, fill = NA),
        legend.key.size = unit(0.7, "lines"),
        legend.title = element_markdown(size = 30, face = "bold", 
                                        lineheight = 0.2),
        legend.text = element_markdown(size = 28),
        axis.title = element_markdown(size = 30),
        plot.caption = element_markdown(size = 20, color = "#333333"),
        axis.text = element_markdown(size = 25),
        strip.text = element_markdown(face = "bold", size = 26))
        legend.background = element_rect(color = NA)

ggsave("uy_fig.png", width = 9, height = 5)
```

